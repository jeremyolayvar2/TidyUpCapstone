@using TidyUpCapstone.Models;

@{
    ViewBag.HideNavigation = false;
}

@section Styles {
    <link rel="stylesheet" href="~/css/settings.css" />
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
}

<!-- Settings container that adapts to sidebar state -->
<div class="settings-container" id="settings-container">
    <div class="settings-header">
        <h1>Settings > <span id="current-tab-name">My Account</span></h1>
    </div>

    <div class="settings-layout">
        <!-- Sidebar Navigation -->
        <div class="settings-sidebar">
            <div class="sidebar-header">
                <h2>My Account</h2>
            </div>
            <ul class="sidebar-menu">
                <li>
                    <a href="#" class="tab-link active" data-tab="profile">
                        <i class="bx bx-user"></i>
                        <span>Profile & Account</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="tab-link" data-tab="privacy">
                        <i class="bx bx-shield"></i>
                        <span>Privacy & Visibility</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="tab-link" data-tab="notifications">
                        <i class="bx bx-bell"></i>
                        <span>Notifications</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="tab-link" data-tab="security">
                        <i class="bx bx-lock"></i>
                        <span>Security</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="tab-link" data-tab="activity">
                        <i class="bx bx-trophy"></i>
                        <span>Token & Activity</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="tab-link" data-tab="language">
                        <i class="bx bx-globe"></i>
                        <span>Language & Accessibility</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="tab-link" data-tab="support">
                        <i class="bx bx-help-circle"></i>
                        <span>Support & Legal</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="settings-content">
            <!-- Profile Tab - MODERN DESIGN -->
            <!-- FIXED Profile Tab - Replace the entire #profile div in your SettingsPage.cshtml -->

            <div id="profile" class="tab-content active" style="display: block !important; visibility: visible !important; opacity: 1 !important;">
                <div class="content-header">
                    <h3>Profile & Account Settings</h3>
                    <p>Manage your personal information and account details</p>
                </div>

                <div class="profile-container">
                    <!-- Profile Picture and Edit Section -->
                    <div class="profile-header-section">
                        <div class="profile-picture-container">
                            <div class="profile-avatar-large" id="profile-avatar-upload">
                                📷
                            </div>
                            <div class="verification-badge" id="verification-badge" style="display: flex;">
                                <i class="bx bx-check-shield"></i>
                            </div>
                        </div>

                        <button type="button" class="btn-edit-modern" id="edit-profile-btn">
                            <i class="bx bx-edit"></i>
                            Edit
                        </button>
                    </div>

                    <!-- Profile Information Form -->
                    <form method="post" asp-action="UpdateProfile" asp-controller="Settings">
                        <!-- Personal Information Grid -->
                        <div class="profile-form-grid">
                            <!-- Left Column -->
                            <div class="form-column">
                                <div class="form-group-modern">
                                    <label for="firstName">First Name</label>
                                    <input type="text" id="firstName" name="FirstName" placeholder="First Name" value="John" />
                                </div>

                                <div class="form-group-modern">
                                    <label for="email">Email</label>
                                    <input type="email" id="email" name="Email" placeholder="jovanjeremy@gmail.com" value="jovanjeremy@gmail.com" />
                                </div>
                            </div>

                            <!-- Right Column -->
                            <div class="form-column">
                                <div class="form-group-modern">
                                    <label for="lastName">Last Name</label>
                                    <input type="text" id="lastName" name="LastName" placeholder="Last Name" value="Doe" />
                                </div>

                                <div class="form-group-modern">
                                    <label for="location">Location</label>
                                    <input type="text" id="location" name="Location" placeholder="Set Location" value="Manila, Philippines" />
                                </div>
                            </div>

                            <!-- Phone Field - Full Width -->
                            <div class="form-group-modern phone-group">
                                <label for="phone">Phone</label>
                                <div class="phone-input-wrapper">
                                    <input type="tel" id="phone" name="Phone" placeholder="000-00000-000" value="+63 912 345 6789" />
                                    <button type="button" class="btn-get-verified" id="verify-phone-btn">
                                        Get Verified
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Account Details Section -->
                        <div class="account-details-modern">
                            <div class="account-details-grid">
                                <!-- Left Side - Form Fields -->
                                <div class="account-form-section">
                                    <div class="form-group-account">
                                        <label for="username">User Name</label>
                                        <input type="text" id="username" name="Username" placeholder="jovalayvar" value="jovalayvar" />
                                    </div>

                                    <div class="form-group-account">
                                        <label for="password">Password</label>
                                        <div class="password-input-wrapper">
                                            <input type="password" id="password" name="Password" placeholder="........" value="password123" />
                                            <button type="button" class="btn-toggle-password-modern" id="toggle-password">
                                                <i class="bx bx-hide"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="form-group-account">
                                        <label for="gender">Gender</label>
                                        <select id="gender" name="Gender" class="select-modern">
                                            <option value="">Select</option>
                                            <option value="male" selected>Male</option>
                                            <option value="female">Female</option>
                                            <option value="other">Other</option>
                                            <option value="prefer-not-to-say">Prefer not to say</option>
                                        </select>
                                    </div>

                                    <div class="form-group-account">
                                        <label for="birthday">Birthday</label>
                                        <input type="date" id="birthday" name="Birthday" value="1990-01-01" placeholder="00/00/00" />
                                    </div>
                                </div>

                                <!-- Right Side - Connected Accounts -->
                                <div class="connected-accounts-modern">
                                    <h3>Connected Accounts</h3>

                                    <div class="account-item-modern">
                                        <div class="account-info-modern">
                                            <div class="account-icon-modern facebook-icon">
                                                <i class="bx bxl-facebook"></i>
                                            </div>
                                            <span>Facebook</span>
                                        </div>
                                        <button type="button" class="btn-connect-modern" data-account="facebook">
                                            <i class="bx bx-plus"></i>
                                        </button>
                                    </div>

                                    <div class="account-item-modern">
                                        <div class="account-info-modern">
                                            <div class="account-icon-modern google-icon">
                                                <i class="bx bxl-google"></i>
                                            </div>
                                            <span>Google Chrome</span>
                                        </div>
                                        <button type="button" class="btn-connect-modern" data-account="google">
                                            <i class="bx bx-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Save Button -->
                        <div class="save-button-container">
                            <button type="submit" class="btn-save-modern">Save Changes</button>
                        </div>
                    </form>
                </div>

                <!-- Phone Verification Modal -->
                <div class="verification-modal" id="phone-verification-modal">
                    <div class="verification-modal-content">
                        <div class="verification-modal-header">
                            <h3>Verify Your Phone Number</h3>
                            <button type="button" class="btn-close-modal" id="close-verification-modal">
                                <i class="bx bx-x"></i>
                            </button>
                        </div>

                        <div class="verification-steps">
                            <!-- Step 1: Enter Phone Number -->
                            <div class="verification-step active" id="step-phone">
                                <div class="step-content">
                                    <div class="step-icon">
                                        <i class="bx bx-phone"></i>
                                    </div>
                                    <h4>Enter Your Phone Number</h4>
                                    <p>We'll send you a verification code via SMS</p>

                                    <div class="phone-number-input">
                                        <select id="country-code" class="country-code-select">
                                            <option value="+1">🇺🇸 +1</option>
                                            <option value="+63" selected>🇵🇭 +63</option>
                                            <option value="+44">🇬🇧 +44</option>
                                            <option value="+81">🇯🇵 +81</option>
                                            <option value="+86">🇨🇳 +86</option>
                                        </select>
                                        <input type="tel" id="verification-phone" placeholder="Enter phone number" />
                                    </div>

                                    <button type="button" class="btn-send-code" id="send-verification-code">
                                        Send Verification Code
                                    </button>
                                </div>
                            </div>

                            <!-- Step 2: Enter Verification Code -->
                            <div class="verification-step" id="step-code">
                                <div class="step-content">
                                    <div class="step-icon">
                                        <i class="bx bx-message-dots"></i>
                                    </div>
                                    <h4>Enter Verification Code</h4>
                                    <p>We sent a 6-digit code to <span id="phone-display"></span></p>

                                    <div class="code-input-container">
                                        <input type="text" class="code-input" maxlength="1" data-index="0">
                                        <input type="text" class="code-input" maxlength="1" data-index="1">
                                        <input type="text" class="code-input" maxlength="1" data-index="2">
                                        <input type="text" class="code-input" maxlength="1" data-index="3">
                                        <input type="text" class="code-input" maxlength="1" data-index="4">
                                        <input type="text" class="code-input" maxlength="1" data-index="5">
                                    </div>

                                    <div class="verification-actions">
                                        <button type="button" class="btn-verify-code" id="verify-code-btn">
                                            Verify Code
                                        </button>
                                        <button type="button" class="btn-resend-code" id="resend-code-btn">
                                            Resend Code <span id="resend-timer"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3: Success -->
                            <div class="verification-step" id="step-success">
                                <div class="step-content">
                                    <div class="step-icon success">
                                        <i class="bx bx-check-circle"></i>
                                    </div>
                                    <h4>Phone Verified Successfully!</h4>
                                    <p>Your phone number has been verified and your account is now secure.</p>

                                    <button type="button" class="btn-complete-verification" id="complete-verification">
                                        Complete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal Overlay -->
                <div class="modal-overlay" id="modal-overlay"></div>
            </div>

            <!-- Privacy Tab -->
            <div id="privacy" class="tab-content">
                <div class="content-header">
                    <h3>Privacy & Visibility</h3>
                    <p>Control who can see your information and activity</p>
                </div>

                <form method="post" asp-action="UpdatePrivacy" asp-controller="Settings">
                    <div class="privacy-section">
                        <div class="toggle-group">
                            <div>
                                <h4>Profile Visibility</h4>
                                <p>Control who can see your profile information</p>
                            </div>
                            <div class="toggle-buttons" data-setting="profile-visibility">
                                <input type="hidden" name="ProfileVisibility" value="public" />
                                <button type="button" class="toggle-btn active" data-value="public">Public</button>
                                <button type="button" class="toggle-btn" data-value="friends">Friends</button>
                                <button type="button" class="toggle-btn" data-value="private">Private</button>
                            </div>
                        </div>
                    </div>

                    <div class="privacy-section">
                        <div class="toggle-group">
                            <div>
                                <h4>Location Sharing</h4>
                                <p>Show or hide your location information</p>
                            </div>
                            <div class="toggle-buttons" data-setting="location-visibility">
                                <input type="hidden" name="LocationVisibility" value="show" />
                                <button type="button" class="toggle-btn active" data-value="show">Show</button>
                                <button type="button" class="toggle-btn" data-value="hide">Hide</button>
                            </div>
                        </div>
                    </div>

                    <div class="privacy-section">
                        <div class="toggle-group">
                            <div>
                                <h4>Activity Streaks</h4>
                                <p>Display your activity streaks to others</p>
                            </div>
                            <div class="toggle-buttons" data-setting="activity-streaks">
                                <input type="hidden" name="ActivityStreaksVisibility" value="show" />
                                <button type="button" class="toggle-btn active" data-value="show">Show</button>
                                <button type="button" class="toggle-btn" data-value="hide">Hide</button>
                            </div>
                        </div>
                    </div>

                    <div class="privacy-section">
                        <div class="toggle-group">
                            <div>
                                <h4>Online Status</h4>
                                <p>Show when you're online</p>
                            </div>
                            <div class="toggle-buttons" data-setting="online-status">
                                <input type="hidden" name="OnlineStatus" value="show" />
                                <button type="button" class="toggle-btn active" data-value="show">Show</button>
                                <button type="button" class="toggle-btn" data-value="hide">Hide</button>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-save">Save Privacy Settings</button>
                </form>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications" class="tab-content">
                <div class="content-header">
                    <h3>Notification Preferences</h3>
                    <p>Manage how and when you receive notifications</p>
                </div>

                <form method="post" asp-action="UpdateNotifications" asp-controller="Settings">
                    <div class="notification-section">
                        <h4>Email Notifications</h4>
                        <div class="notification-item">
                            <div class="notification-info">
                                <span>New Messages</span>
                                <small>Receive email when you get new messages</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="EmailNewMessages" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-info">
                                <span>Item Updates</span>
                                <small>Get notified about item status changes</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="EmailItemUpdates" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-info">
                                <span>Weekly Summary</span>
                                <small>Receive weekly activity summary</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="EmailWeeklySummary">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="notification-section">
                        <h4>Push Notifications</h4>
                        <div class="notification-item">
                            <div class="notification-info">
                                <span>Browser Notifications</span>
                                <small>Show notifications in your browser</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="BrowserNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="notification-item">
                            <div class="notification-info">
                                <span>Sound Alerts</span>
                                <small>Play sound for new notifications</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="SoundAlerts">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn-save">Save Notification Settings</button>
                </form>
            </div>

            <!-- Security Tab -->
            <div id="security" class="tab-content">
                <div class="content-header">
                    <h3>Security Settings</h3>
                    <p>Manage your account security and login preferences</p>
                </div>

                <form method="post" asp-action="UpdateSecurity" asp-controller="Settings">
                    <div class="security-section">
                        <h4>Change Password</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="currentPassword">Current Password</label>
                                <input type="password" id="currentPassword" name="CurrentPassword" />
                            </div>
                            <div class="form-group">
                                <label for="newPassword">New Password</label>
                                <input type="password" id="newPassword" name="NewPassword" />
                            </div>
                            <div class="form-group full-width">
                                <label for="confirmNewPassword">Confirm New Password</label>
                                <input type="password" id="confirmNewPassword" name="ConfirmNewPassword" />
                            </div>
                        </div>
                    </div>

                    <div class="security-section">
                        <h4>Two-Factor Authentication</h4>
                        <div class="security-item">
                            <div class="security-info">
                                <span>Enable 2FA</span>
                                <small>Add an extra layer of security to your account</small>
                            </div>
                            <button type="button" class="btn-secondary" id="enable-2fa">Enable</button>
                        </div>
                    </div>

                    <div class="security-section">
                        <h4>Login Sessions</h4>
                        <div class="session-item">
                            <div class="session-info">
                                <span>Current Session</span>
                                <small>Chrome on Windows • Active now</small>
                            </div>
                            <span class="session-status active">Active</span>
                        </div>
                        <div class="session-item">
                            <div class="session-info">
                                <span>Mobile App</span>
                                <small>iOS App • Last seen 2 hours ago</small>
                            </div>
                            <button type="button" class="btn-danger-small">End Session</button>
                        </div>
                    </div>

                    <button type="submit" class="btn-save">Update Security Settings</button>
                </form>
            </div>

            <!-- Token & Activity Tab -->
            <div id="activity" class="tab-content">
                <div class="content-header">
                    <h3>Token & Activity</h3>
                    <p>View your tokens and activity history</p>
                </div>

                <div class="activity-stats">
                    <div class="stat-card">
                        <div class="stat-icon">🪙</div>
                        <div class="stat-info">
                            <h4>1,250</h4>
                            <span>Total Tokens</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">📈</div>
                        <div class="stat-info">
                            <h4>15</h4>
                            <span>Items Posted</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">🎯</div>
                        <div class="stat-info">
                            <h4>8</h4>
                            <span>Items Claimed</span>
                        </div>
                    </div>
                </div>

                <div class="activity-section">
                    <h4>Recent Activity</h4>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon">📝</div>
                            <div class="activity-info">
                                <span>Posted "Vintage Camera"</span>
                                <small>2 hours ago</small>
                            </div>
                            <span class="activity-tokens">+50 tokens</span>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">🎯</div>
                            <div class="activity-info">
                                <span>Claimed "Office Chair"</span>
                                <small>1 day ago</small>
                            </div>
                            <span class="activity-tokens">-30 tokens</span>
                        </div>
                        <div class="activity-item">
                            <div class="activity-icon">⭐</div>
                            <div class="activity-info">
                                <span>Completed daily challenge</span>
                                <small>2 days ago</small>
                            </div>
                            <span class="activity-tokens">+25 tokens</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Language & Accessibility Tab -->
            <div id="language" class="tab-content">
                <div class="content-header">
                    <h3>Language & Accessibility</h3>
                    <p>Customize language and accessibility options</p>
                </div>

                <form method="post" asp-action="UpdateLanguage" asp-controller="Settings">
                    <div class="language-section">
                        <h4>Language Preferences</h4>
                        <div class="form-group">
                            <label for="language">Interface Language</label>
                            <select id="language" name="Language">
                                <option value="en">English</option>
                                <option value="es">Español</option>
                                <option value="fr">Français</option>
                                <option value="de">Deutsch</option>
                                <option value="ja">日本語</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="timezone">Timezone</label>
                            <select id="timezone" name="Timezone">
                                <option value="UTC">UTC</option>
                                <option value="PST">Pacific Standard Time</option>
                                <option value="EST">Eastern Standard Time</option>
                                <option value="GMT">Greenwich Mean Time</option>
                            </select>
                        </div>
                    </div>

                    <div class="accessibility-section">
                        <h4>Accessibility Options</h4>
                        <div class="accessibility-item">
                            <div class="accessibility-info">
                                <span>High Contrast Mode</span>
                                <small>Improve text visibility</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="HighContrast">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="accessibility-item">
                            <div class="accessibility-info">
                                <span>Reduce Motion</span>
                                <small>Minimize animations and transitions</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" name="ReduceMotion">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="fontSize">Font Size</label>
                            <select id="fontSize" name="FontSize">
                                <option value="small">Small</option>
                                <option value="medium" selected>Medium</option>
                                <option value="large">Large</option>
                                <option value="extra-large">Extra Large</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn-save">Save Language Settings</button>
                </form>
            </div>

            <!-- Support & Legal Tab -->
            <div id="support" class="tab-content">
                <div class="content-header">
                    <h3>Support & Legal</h3>
                    <p>Get help and view legal information</p>
                </div>

                <div class="support-section">
                    <h4>Help & Support</h4>
                    <div class="support-links">
                        <a href="#" class="support-link">
                            <i class="bx bx-help-circle"></i>
                            <div>
                                <span>Help Center</span>
                                <small>Find answers to common questions</small>
                            </div>
                        </a>
                        <a href="#" class="support-link">
                            <i class="bx bx-message"></i>
                            <div>
                                <span>Contact Support</span>
                                <small>Get help from our support team</small>
                            </div>
                        </a>
                        <a href="#" class="support-link">
                            <i class="bx bx-bug"></i>
                            <div>
                                <span>Report a Bug</span>
                                <small>Let us know about any issues</small>
                            </div>
                        </a>
                    </div>
                </div>

                <div class="legal-section">
                    <h4>Legal Information</h4>
                    <div class="legal-links">
                        <a href="#" class="legal-link">Terms of Service</a>
                        <a href="#" class="legal-link">Privacy Policy</a>
                        <a href="#" class="legal-link">Cookie Policy</a>
                        <a href="#" class="legal-link">Community Guidelines</a>
                    </div>
                </div>

                <div class="account-actions">
                    <h4>Account Actions</h4>
                    <div class="action-buttons">
                        <button type="button" class="btn-secondary" id="export-data">
                            <i class="bx bx-download"></i>
                            Export My Data
                        </button>
                        <button type="button" class="btn-secondary" id="deactivate-account">
                            <i class="bx bx-pause"></i>
                            Deactivate Account
                        </button>
                        <button type="button" class="btn-logout" id="logout-btn">
                            <i class="bx bx-log-out"></i>
                            Logout
                        </button>
                    </div>
                </div>

                <div class="danger-zone">
                    <h4>Danger Zone</h4>
                    <p>Once you delete your account, there is no going back. Please be certain.</p>
                    <button type="button" class="btn-danger" id="delete-account-btn">
                        <i class="bx bx-trash"></i>
                        Delete Account
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/settings.js"></script>

  

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 Debugging Profile Content Visibility...');

            // Function to force show all profile content
            function forceShowProfileContent() {
                console.log('🚀 Forcing profile content to show...');

                const profileTab = document.getElementById('profile');

                if (!profileTab) {
                    console.error('❌ Profile tab not found!');
                    return;
                }

                // Force the main profile tab to be visible
                profileTab.style.display = 'block';
                profileTab.style.visibility = 'visible';
                profileTab.style.opacity = '1';
                profileTab.style.position = 'relative';
                profileTab.style.zIndex = '1';
                profileTab.classList.add('active');

                console.log('✅ Profile tab visibility set');

                // Force all child elements to be visible
                const allElements = profileTab.querySelectorAll('*');
                allElements.forEach((element, index) => {
                    // Don't mess with the modal elements
                    if (!element.closest('.verification-modal') && !element.closest('.modal-overlay')) {
                        element.style.display = '';
                        element.style.visibility = 'visible';
                        element.style.opacity = '1';

                        // Special handling for flex and grid containers
                        if (element.classList.contains('profile-form-grid') ||
                            element.classList.contains('account-details-grid') ||
                            element.classList.contains('account-form-section')) {
                            element.style.display = 'grid';
                        }

                        if (element.classList.contains('profile-header-section') ||
                            element.classList.contains('phone-input-wrapper') ||
                            element.classList.contains('password-input-wrapper') ||
                            element.classList.contains('account-info-modern') ||
                            element.classList.contains('btn-edit-modern') ||
                            element.classList.contains('profile-avatar-large') ||
                            element.classList.contains('verification-badge') ||
                            element.classList.contains('account-item-modern') ||
                            element.classList.contains('btn-connect-modern') ||
                            element.classList.contains('save-button-container') ||
                            element.classList.contains('form-column') ||
                            element.classList.contains('form-group-modern') ||
                            element.classList.contains('form-group-account')) {
                            element.style.display = 'flex';
                        }
                    }
                });

                console.log(`✅ Processed ${allElements.length} elements`);

                // Hide other tabs
                const allTabs = document.querySelectorAll('.tab-content');
                allTabs.forEach(tab => {
                    if (tab.id !== 'profile') {
                        tab.style.display = 'none';
                        tab.classList.remove('active');
                    }
                });

                // Update active tab link
                const profileLink = document.querySelector('[data-tab="profile"]');
                if (profileLink) {
                    profileLink.classList.add('active');
                }

                console.log('✅ Profile content forced to show!');

                // Debug what's visible
                setTimeout(() => {
                    debugProfileContent();
                }, 500);
            }

            // Debug function to check what's visible
            function debugProfileContent() {
                console.log('🔍 Debugging profile content...');

                const elements = [
                    'profile',
                    'profile-container',
                    'profile-header-section',
                    'profile-form-grid',
                    'account-details-modern',
                    'connected-accounts-modern'
                ];

                elements.forEach(className => {
                    const element = document.getElementById(className) || document.querySelector('.' + className);
                    if (element) {
                        const styles = getComputedStyle(element);
                        console.log(`📋 ${className}:`, {
                            display: styles.display,
                            visibility: styles.visibility,
                            opacity: styles.opacity,
                            height: styles.height,
                            width: styles.width
                        });
                    } else {
                        console.warn(`⚠️ Element not found: ${className}`);
                    }
                });
            }

            // Add CSS fixes directly via JavaScript
            function addCriticalCSS() {
                const style = document.createElement('style');
                style.id = 'profile-visibility-fix';
                style.textContent = `
                    #profile {
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                        position: relative !important;
                        z-index: 1 !important;
                    }

                    #profile * {
                        visibility: visible !important;
                        opacity: 1 !important;
                    }

                    #profile .profile-container,
                    #profile .profile-header-section,
                    #profile .profile-form-grid,
                    #profile .form-column,
                    #profile .form-group-modern,
                    #profile .account-details-modern,
                    #profile .account-details-grid,
                    #profile .account-form-section,
                    #profile .form-group-account,
                    #profile .connected-accounts-modern,
                    #profile .account-item-modern,
                    #profile .save-button-container {
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                    }

                    #profile .profile-header-section,
                    #profile .phone-input-wrapper,
                    #profile .password-input-wrapper,
                    #profile .account-info-modern,
                    #profile .btn-edit-modern,
                    #profile .profile-avatar-large,
                    #profile .verification-badge,
                    #profile .account-item-modern,
                    #profile .btn-connect-modern,
                    #profile .save-button-container,
                    #profile .form-column,
                    #profile .form-group-modern,
                    #profile .form-group-account {
                        display: flex !important;
                    }

                    #profile .profile-form-grid,
                    #profile .account-details-grid,
                    #profile .account-form-section {
                        display: grid !important;
                    }

                    #profile input,
                    #profile select,
                    #profile label,
                    #profile button,
                    #profile h3,
                    #profile span {
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                    }

                    #profile .profile-form-grid {
                        grid-template-columns: 1fr 1fr !important;
                        gap: 24px !important;
                    }

                    #profile .account-details-grid {
                        grid-template-columns: 1fr 320px !important;
                        gap: 40px !important;
                    }

                    #profile .account-form-section {
                        grid-template-columns: 1fr 1fr !important;
                        gap: 20px !important;
                    }

                    @@media (max-width: 768px) {
                        #profile .profile-form-grid {
                            grid-template-columns: 1fr !important;
                        }

                        #profile .account-details-grid {
                            grid-template-columns: 1fr !important;
                        }

                        #profile .account-form-section {
                            grid-template-columns: 1fr !important;
                        }

                        #profile .phone-input-wrapper {
                            flex-direction: column !important;
                        }
                    }
                `;

                // Remove existing style if it exists
                const existingStyle = document.getElementById('profile-visibility-fix');
                if (existingStyle) {
                    existingStyle.remove();
                }

                document.head.appendChild(style);
                console.log('✅ Critical CSS added via JavaScript');
            }

            // Run the fixes
            addCriticalCSS();

            // Run immediately
            forceShowProfileContent();

            // Run multiple times to ensure it works
            setTimeout(forceShowProfileContent, 100);
            setTimeout(forceShowProfileContent, 500);
            setTimeout(forceShowProfileContent, 1000);

            // Add a manual trigger function for testing
            window.fixProfileContent = forceShowProfileContent;
            window.debugProfile = debugProfileContent;

            console.log('🎯 Profile visibility fix loaded. Use fixProfileContent() or debugProfile() in console if needed.');
        });

        // Also run when the tab is clicked
        document.addEventListener('click', function(e) {
            if (e.target.closest('[data-tab="profile"]')) {
                setTimeout(() => {
                    console.log('🔄 Profile tab clicked, re-running visibility fix...');

                    const profileTab = document.getElementById('profile');
                    if (profileTab) {
                        profileTab.style.display = 'block';
                        profileTab.style.visibility = 'visible';
                        profileTab.style.opacity = '1';
                        profileTab.classList.add('active');

                        // Force all content to be visible
                        const allElements = profileTab.querySelectorAll('*');
                        allElements.forEach(element => {
                            if (!element.closest('.verification-modal') && !element.closest('.modal-overlay')) {
                                element.style.visibility = 'visible';
                                element.style.opacity = '1';
                            }
                        });
                    }
                }, 50);
            }
        });

        // Additional fix for tab switching
        document.addEventListener('DOMContentLoaded', function() {
            // Force profile tab to be active on load
            const profileLink = document.querySelector('[data-tab="profile"]');
            const profileTab = document.getElementById('profile');

            if (profileLink && profileTab) {
                profileLink.classList.add('active');
                profileTab.classList.add('active');
                profileTab.style.display = 'block';
                profileTab.style.visibility = 'visible';
                profileTab.style.opacity = '1';

                // Hide other tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    if (tab.id !== 'profile') {
                        tab.style.display = 'none';
                        tab.classList.remove('active');
                    }
                });

                // Update header
                const currentTabName = document.getElementById('current-tab-name');
                if (currentTabName) {
                    currentTabName.textContent = 'Profile & Account';
                }
            }
        });

        // Force profile content visibility every 2 seconds for the first 10 seconds
        let retryCount = 0;
        const maxRetries = 5;
        const retryInterval = setInterval(() => {
            const profileTab = document.getElementById('profile');
            if (profileTab && retryCount < maxRetries) {
                const isVisible = getComputedStyle(profileTab).display !== 'none' &&
                                 getComputedStyle(profileTab).visibility !== 'hidden';

                if (!isVisible) {
                    console.log(`🔄 Retry ${retryCount + 1}: Forcing profile visibility...`);
                    if (window.fixProfileContent) {
                        window.fixProfileContent();
                    }
                }

                retryCount++;
            } else {
                clearInterval(retryInterval);
                console.log('✅ Profile visibility monitoring stopped');
            }
        }, 2000);
    </script>
}