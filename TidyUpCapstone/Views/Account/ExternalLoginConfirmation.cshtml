@{
    ViewBag.HideNavigation = true;
    ViewData["Title"] = "Complete Registration";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="~/css/ExternalLoginConfirmation.css" />
}

@model TidyUpCapstone.Models.ViewModels.Account.ExternalLoginConfirmationViewModel

<div class="registration-container d-flex align-items-center justify-content-center min-vh-100">
    <div class="registration-card">
        <div class="card-body p-5">

            <!-- Header -->
            <div class="text-center mb-4">
                <h1 class="registration-header">Complete Your Registration</h1>
                <p class="text-muted small mb-0">
                    Just a few more details to finish setting up your TidyUp account.
                </p>
            </div>

            <!-- Error Summary -->
            @if (!ViewData.ModelState.IsValid)
            {
                <div class="alert alert-danger-custom mb-4">
                    <div class="alert-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="alert-content">
                        <h6 class="alert-title">Please fix the following errors:</h6>
                        <div asp-validation-summary="All" class="mb-0 error-list"></div>
                    </div>
                </div>
            }

            <!-- Form -->
            <form asp-action="ExternalLoginConfirmation" method="post" novalidate id="registrationForm">
                @Html.AntiForgeryToken()

                <!-- Hidden Fields -->
                <input type="hidden" asp-for="ReturnUrl" />
                <input type="hidden" asp-for="Provider" />
                <input type="hidden" asp-for="ProviderUserId" />
                <input type="hidden" asp-for="ProviderDisplayName" />
                <input type="hidden" asp-for="ProviderAvatarUrl" />

                <!-- Email (Read-only) -->
                <div class="mb-4">
                    <div class="flex flex-col">
                        <div class="input-wrapper">
                            <input asp-for="Email"
                                   class="login-form-control bg-light"
                                   readonly
                                   placeholder=" " />
                        </div>
                        
                    </div>
                    <small class="provider-text">Connected via @Model.Provider</small>
                    <span asp-validation-for="Email" class="text-danger small"></span>
                </div>

                <!-- Username -->
                <div class="mb-4">
                    <div class="flex flex-col">
                        <input asp-for="Username"
                               class="login-form-control @(Html.ViewData.ModelState["Username"]?.Errors.Count > 0 ? "is-invalid" : "")"
                               placeholder=" "
                               required />
                        <label asp-for="Username" class="login-form-label">Username</label>
                    </div>
                    <span asp-validation-for="Username" class="text-danger small"></span>
                    <small class="text-muted">This will be your unique identifier on TidyUp.</small>
                </div>

                <!-- First Name -->
                <div class="mb-4">
                    <div class="flex flex-col">
                        <input asp-for="FirstName"
                               class="login-form-control @(Html.ViewData.ModelState["FirstName"]?.Errors.Count > 0 ? "is-invalid" : "")"
                               placeholder=" "
                               required />
                        <label asp-for="FirstName" class="login-form-label">First Name</label>
                    </div>
                    <span asp-validation-for="FirstName" class="text-danger small"></span>
                </div>

                <!-- Last Name -->
                <div class="mb-4">
                    <div class="flex flex-col">
                        <input asp-for="LastName"
                               class="login-form-control @(Html.ViewData.ModelState["LastName"]?.Errors.Count > 0 ? "is-invalid" : "")"
                               placeholder=" "
                               required />
                        <label asp-for="LastName" class="login-form-label">Last Name</label>
                    </div>
                    <span asp-validation-for="LastName" class="text-danger small"></span>
                </div>

                <!-- Terms & Privacy -->
                <div class="checkbox-group mb-4">
                    <div class="custom-checkbox-wrapper">
                        <input asp-for="AcceptTerms"
                               class="custom-checkbox @(Html.ViewData.ModelState["AcceptTerms"]?.Errors.Count > 0 ? "is-invalid" : "")"
                               type="checkbox"
                               required />
                        <label asp-for="AcceptTerms" class="custom-checkbox-label">
                            <span class="checkbox-checkmark"></span>
                            I accept the <a href="@Url.Action("Terms", "Legal")" target="_blank" class="text-primary">Terms and Conditions</a>
                        </label>
                        <span asp-validation-for="AcceptTerms" class="text-danger small"></span>
                    </div>

                    <div class="custom-checkbox-wrapper">
                        <input asp-for="AcceptPrivacy"
                               class="custom-checkbox @(Html.ViewData.ModelState["AcceptPrivacy"]?.Errors.Count > 0 ? "is-invalid" : "")"
                               type="checkbox"
                               required />
                        <label asp-for="AcceptPrivacy" class="custom-checkbox-label">
                            <span class="checkbox-checkmark"></span>
                            I accept the <a href="@Url.Action("Privacy", "Legal")" target="_blank" class="text-primary">Privacy Policy</a>
                        </label>
                        <span asp-validation-for="AcceptPrivacy" class="text-danger small"></span>
                    </div>

                    <div class="custom-checkbox-wrapper">
                        <input asp-for="MarketingEmails"
                               class="custom-checkbox"
                               type="checkbox" />
                        <label asp-for="MarketingEmails" class="custom-checkbox-label">
                            <span class="checkbox-checkmark"></span>
                            Send me marketing emails (optional)
                        </label>
                    </div>
                </div>

                <!-- Submit -->
                <div class="d-grid mb-3">
                    <button type="submit" class="btn-complete-registration" id="completeRegistrationBtn">
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                       
                        Complete Registration
                    </button>
                </div>
            </form>

            <!-- Already have account -->
            <div class="text-center mt-3">
                <p class="text-muted mb-0">
                    Already have an account?
                    <a href="@Url.Action("Index", "Home")" class="text-primary fw-semibold">Sign in here</a>
                </p>
            </div>

            <!-- Additional Help -->
            <div class="mt-4 pt-3 border-top text-center small text-muted">
                Need help? Contact us at
                <a href="mailto:support@tidyup.com" class="text-primary fw-semibold">support@tidyup.com</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        document.getElementById('registrationForm').addEventListener('submit', function () {
            const btn = document.getElementById('completeRegistrationBtn');
            btn.disabled = true;
            btn.querySelector('.spinner-border').classList.remove('d-none');
        });

        // Enhanced form validation feedback
        document.querySelectorAll('.login-form-control').forEach(input => {
            input.addEventListener('blur', function() {
                if (this.checkValidity()) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.add('is-invalid');
                    this.classList.remove('is-valid');
                }
            });
        });

        // Custom checkbox animations
        document.querySelectorAll('.custom-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const checkmark = this.nextElementSibling.querySelector('.checkbox-checkmark');
                if (this.checked) {
                    checkmark.classList.add('checked');
                } else {
                    checkmark.classList.remove('checked');
                }
            });
        });
    </script>
}